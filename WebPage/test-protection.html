<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPADE ä¿æŠ¤ç³»ç»Ÿæµ‹è¯•</title>
    <script src="anti-crawler-protection.js"></script>
    <script src="data-obfuscator.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .test-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.3);
            border-left: 4px solid #4CAF50;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.3);
            border-left: 4px solid #FFC107;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.3);
            border-left: 4px solid #F44336;
        }
        
        .info {
            background: rgba(33, 150, 243, 0.3);
            border-left: 4px solid #2196F3;
        }
        
        button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›¡ï¸ SPADE ä¿æŠ¤ç³»ç»Ÿæµ‹è¯•é¢æ¿</h1>
        
        <!-- åçˆ¬è™«ä¿æŠ¤æµ‹è¯• -->
        <div class="test-card">
            <h2 class="test-title">ğŸš« åçˆ¬è™«ä¿æŠ¤æµ‹è¯•</h2>
            <div id="anti-crawler-results"></div>
            <button onclick="testAntiCrawler()">è¿è¡Œåçˆ¬è™«æµ‹è¯•</button>
            <button onclick="showProtectionStatus()">æ˜¾ç¤ºä¿æŠ¤çŠ¶æ€</button>
        </div>
        
        <!-- æ•°æ®æ··æ·†æµ‹è¯• -->
        <div class="test-card">
            <h2 class="test-title">ğŸ”’ æ•°æ®æ··æ·†æµ‹è¯•</h2>
            <div id="obfuscation-results"></div>
            <button onclick="testDataObfuscation()">è¿è¡Œæ•°æ®æ··æ·†æµ‹è¯•</button>
            <button onclick="testFieldObfuscation()">æµ‹è¯•å­—æ®µæ··æ·†</button>
        </div>
        
        <!-- æ€§èƒ½æµ‹è¯• -->
        <div class="test-card">
            <h2 class="test-title">âš¡ æ€§èƒ½å½±å“æµ‹è¯•</h2>
            <div id="performance-results"></div>
            <button onclick="testPerformance()">è¿è¡Œæ€§èƒ½æµ‹è¯•</button>
        </div>
        
        <!-- å®æ—¶ç»Ÿè®¡ -->
        <div class="test-card">
            <h2 class="test-title">ğŸ“Š å®æ—¶ä¿æŠ¤ç»Ÿè®¡</h2>
            <div class="stats-grid" id="stats-grid">
                <!-- åŠ¨æ€ç”Ÿæˆç»Ÿè®¡é¡¹ -->
            </div>
            <button onclick="updateStats()">æ›´æ–°ç»Ÿè®¡</button>
            <button onclick="clearStats()">æ¸…é™¤ç»Ÿè®¡</button>
        </div>
        
        <!-- æ—¥å¿—é¢æ¿ -->
        <div class="test-card">
            <h2 class="test-title">ğŸ“‹ ä¿æŠ¤æ—¥å¿—</h2>
            <div id="log-panel">
                <pre id="log-content"></pre>
            </div>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        </div>
    </div>

    <script>
        // æµ‹è¯•æ•°æ®
        const testData = {
            "DRAMP ID": "DRAMP00001",
            "Peptide Name": "Test Peptide",
            "Sequence": "ACDEFGHIKLMNPQRSTVWY",
            "Source": "Synthetic",
            "Biological Activity": ["Antibacterial", "Antifungal"],
            "Gene": "TEST_GENE_001",
            "Formula": "C100H150N30O20S5",
            "UniProt Entry": "P12345",
            "PDB ID": "1ABC",
            "Pubmed ID": "12345678",
            "Sequence Information": {
                "Length": 20,
                "Molecular Weight": "2500.5"
            }
        };
        
        let testLogs = [];
        let testStats = {
            totalRequests: 0,
            blockedRequests: 0,
            obfuscatedFields: 0,
            humanScore: 0
        };
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toISOString();
            const logEntry = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
            testLogs.push(logEntry);
            
            const logContent = document.getElementById('log-content');
            if (logContent) {
                logContent.textContent = testLogs.slice(-50).join('\n'); // ä¿ç•™æœ€è¿‘50æ¡æ—¥å¿—
                logContent.scrollTop = logContent.scrollHeight;
            }
        }
        
        // åçˆ¬è™«ä¿æŠ¤æµ‹è¯•
        async function testAntiCrawler() {
            const resultsDiv = document.getElementById('anti-crawler-results');
            resultsDiv.innerHTML = '<div class="test-result info">æ­£åœ¨è¿è¡Œåçˆ¬è™«æµ‹è¯•...</div>';
            
            try {
                log('å¼€å§‹åçˆ¬è™«ä¿æŠ¤æµ‹è¯•');
                
                // æµ‹è¯•1: æ£€æŸ¥ä¿æŠ¤å®ä¾‹æ˜¯å¦å­˜åœ¨
                if (!window.protectionInstance) {
                    throw new Error('åçˆ¬è™«ä¿æŠ¤å®ä¾‹æœªåˆå§‹åŒ–');
                }
                addResult(resultsDiv, 'âœ… ä¿æŠ¤å®ä¾‹å·²æ­£ç¡®åˆå§‹åŒ–', 'success');
                
                // æµ‹è¯•2: æ£€æŸ¥è¡Œä¸ºè¿½è¸ª
                const behaviorScore = window.protectionInstance.userBehavior.humanScore;
                addResult(resultsDiv, `ğŸ“Š å½“å‰ç”¨æˆ·è¡Œä¸ºè¯„åˆ†: ${behaviorScore.toFixed(2)}`, 'info');
                
                // æµ‹è¯•3: æµ‹è¯•è¯·æ±‚é¢‘ç‡é™åˆ¶
                try {
                    for (let i = 0; i < 3; i++) {
                        window.protectionInstance.checkRequestFrequency('/test/endpoint');
                        testStats.totalRequests++;
                    }
                    addResult(resultsDiv, 'âœ… æ­£å¸¸è¯·æ±‚é¢‘ç‡é€šè¿‡æ£€æŸ¥', 'success');
                } catch (error) {
                    addResult(resultsDiv, `âš ï¸ è¯·æ±‚é¢‘ç‡é™åˆ¶è§¦å‘: ${error.message}`, 'warning');
                    testStats.blockedRequests++;
                }
                
                // æµ‹è¯•4: æµ‹è¯•äººç±»è¡Œä¸ºæ£€æµ‹
                const isHuman = window.protectionInstance.isHumanBehavior();
                addResult(resultsDiv, `ğŸ¤– äººç±»è¡Œä¸ºæ£€æµ‹ç»“æœ: ${isHuman ? 'é€šè¿‡' : 'æœªé€šè¿‡'}`, isHuman ? 'success' : 'warning');
                
                // æµ‹è¯•5: è·å–ä¿æŠ¤çŠ¶æ€
                const status = window.protectionInstance.getProtectionStatus();
                addResult(resultsDiv, `ğŸ“ˆ ä¼šè¯æ—¶é•¿: ${(status.uptime / 1000).toFixed(1)}ç§’`, 'info');
                addResult(resultsDiv, `ğŸ”¢ è¯·æ±‚è®¡æ•°: ${status.requestCount}`, 'info');
                
                log('åçˆ¬è™«ä¿æŠ¤æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                addResult(resultsDiv, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`åçˆ¬è™«æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ•°æ®æ··æ·†æµ‹è¯•
        async function testDataObfuscation() {
            const resultsDiv = document.getElementById('obfuscation-results');
            resultsDiv.innerHTML = '<div class="test-result info">æ­£åœ¨è¿è¡Œæ•°æ®æ··æ·†æµ‹è¯•...</div>';
            
            try {
                log('å¼€å§‹æ•°æ®æ··æ·†æµ‹è¯•');
                
                // æµ‹è¯•1: æ£€æŸ¥æ··æ·†å™¨å®ä¾‹
                if (!window.dataObfuscator) {
                    throw new Error('æ•°æ®æ··æ·†å™¨å®ä¾‹æœªåˆå§‹åŒ–');
                }
                addResult(resultsDiv, 'âœ… æ•°æ®æ··æ·†å™¨å·²æ­£ç¡®åˆå§‹åŒ–', 'success');
                
                // æµ‹è¯•2: æµ‹è¯•å­—ç¬¦ä¸²æ··æ·†
                const originalString = "ACDEFGHIKLMNPQRSTVWY";
                const obfuscated = window.dataObfuscator.obfuscateString(originalString, 'Sequence');
                const deobfuscated = window.dataObfuscator.deobfuscateString(obfuscated, 'Sequence');
                
                if (deobfuscated === originalString) {
                    addResult(resultsDiv, 'âœ… å­—ç¬¦ä¸²æ··æ·†/è§£æ··æ·†æˆåŠŸ', 'success');
                    addResult(resultsDiv, `ğŸ” åŸå§‹: "${originalString}"`, 'info');
                    addResult(resultsDiv, `ğŸ”’ æ··æ·†: "${obfuscated.substring(0, 20)}..."`, 'info');
                } else {
                    throw new Error('å­—ç¬¦ä¸²æ··æ·†/è§£æ··æ·†å¤±è´¥');
                }
                
                // æµ‹è¯•3: æµ‹è¯•å¯¹è±¡æ··æ·†
                const obfuscatedData = window.dataObfuscator.obfuscateData(testData);
                const deobfuscatedData = window.dataObfuscator.deobfuscateData(obfuscatedData);
                
                // æ£€æŸ¥å…³é”®å­—æ®µæ˜¯å¦æ­£ç¡®æ¢å¤
                if (deobfuscatedData['DRAMP ID'] === testData['DRAMP ID'] &&
                    deobfuscatedData['Sequence'] === testData['Sequence']) {
                    addResult(resultsDiv, 'âœ… å¯¹è±¡æ··æ·†/è§£æ··æ·†æˆåŠŸ', 'success');
                    testStats.obfuscatedFields += Object.keys(testData).length;
                } else {
                    throw new Error('å¯¹è±¡æ··æ·†/è§£æ··æ·†å¤±è´¥');
                }
                
                // æµ‹è¯•4: æ··æ·†ç»Ÿè®¡
                const stats = window.dataObfuscator.getObfuscationStats(testData);
                addResult(resultsDiv, `ğŸ“Š æ··æ·†ç‡: ${stats.obfuscationRate}`, 'info');
                addResult(resultsDiv, `ğŸ”¢ æ··æ·†å­—æ®µ: ${stats.obfuscatedFields}/${stats.totalFields}`, 'info');
                
                // æµ‹è¯•5: è¯±é¥µæ•°æ®
                const withDecoy = window.dataObfuscator.addDecoyData(testData);
                const cleanData = window.dataObfuscator.removeDecoyData(withDecoy);
                const hasDecoyFields = Object.keys(withDecoy).some(key => key.startsWith('_decoy_'));
                const decoyRemoved = !Object.keys(cleanData).some(key => key.startsWith('_decoy_'));
                
                if (hasDecoyFields && decoyRemoved) {
                    addResult(resultsDiv, 'âœ… è¯±é¥µæ•°æ®æ·»åŠ /ç§»é™¤æˆåŠŸ', 'success');
                } else {
                    addResult(resultsDiv, 'âš ï¸ è¯±é¥µæ•°æ®å¤„ç†å¼‚å¸¸', 'warning');
                }
                
                log('æ•°æ®æ··æ·†æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                addResult(resultsDiv, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`æ•°æ®æ··æ·†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // å­—æ®µæ··æ·†æµ‹è¯•
        function testFieldObfuscation() {
            const resultsDiv = document.getElementById('obfuscation-results');
            
            try {
                log('å¼€å§‹å­—æ®µæ··æ·†ä¸“é¡¹æµ‹è¯•');
                
                const sensitiveFields = ['Sequence', 'DRAMP ID', 'UniProt Entry', 'PDB ID', 'Gene'];
                
                addResult(resultsDiv, 'ğŸ” æ•æ„Ÿå­—æ®µæ··æ·†æµ‹è¯•:', 'info');
                
                sensitiveFields.forEach(field => {
                    if (testData[field]) {
                        const original = testData[field];
                        const obfuscated = window.dataObfuscator.obfuscateString(original.toString(), field);
                        const restored = window.dataObfuscator.deobfuscateString(obfuscated, field);
                        
                        const success = restored === original.toString();
                        addResult(resultsDiv, 
                            `  ${field}: ${success ? 'âœ…' : 'âŒ'} ${success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, 
                            success ? 'success' : 'error'
                        );
                    }
                });
                
                log('å­—æ®µæ··æ·†ä¸“é¡¹æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                addResult(resultsDiv, `âŒ å­—æ®µæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`å­—æ®µæ··æ·†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ€§èƒ½æµ‹è¯•
        async function testPerformance() {
            const resultsDiv = document.getElementById('performance-results');
            resultsDiv.innerHTML = '<div class="test-result info">æ­£åœ¨è¿è¡Œæ€§èƒ½æµ‹è¯•...</div>';
            
            try {
                log('å¼€å§‹æ€§èƒ½å½±å“æµ‹è¯•');
                
                const iterations = 1000;
                
                // æµ‹è¯•1: æ··æ·†æ€§èƒ½
                const startObfuscation = performance.now();
                for (let i = 0; i < iterations; i++) {
                    window.dataObfuscator.obfuscateString("ACDEFGHIKLMNPQRSTVWY", "Sequence");
                }
                const obfuscationTime = performance.now() - startObfuscation;
                
                // æµ‹è¯•2: è§£æ··æ·†æ€§èƒ½
                const obfuscatedTest = window.dataObfuscator.obfuscateString("ACDEFGHIKLMNPQRSTVWY", "Sequence");
                const startDeobfuscation = performance.now();
                for (let i = 0; i < iterations; i++) {
                    window.dataObfuscator.deobfuscateString(obfuscatedTest, "Sequence");
                }
                const deobfuscationTime = performance.now() - startDeobfuscation;
                
                // æµ‹è¯•3: è¡Œä¸ºæ£€æµ‹æ€§èƒ½
                const startBehavior = performance.now();
                for (let i = 0; i < iterations; i++) {
                    window.protectionInstance.isHumanBehavior();
                }
                const behaviorTime = performance.now() - startBehavior;
                
                // æ˜¾ç¤ºç»“æœ
                addResult(resultsDiv, `âš¡ æ··æ·†æ€§èƒ½: ${(obfuscationTime / iterations).toFixed(4)}ms/æ¬¡`, 'info');
                addResult(resultsDiv, `âš¡ è§£æ··æ·†æ€§èƒ½: ${(deobfuscationTime / iterations).toFixed(4)}ms/æ¬¡`, 'info');
                addResult(resultsDiv, `âš¡ è¡Œä¸ºæ£€æµ‹æ€§èƒ½: ${(behaviorTime / iterations).toFixed(4)}ms/æ¬¡`, 'info');
                
                const totalTime = obfuscationTime + deobfuscationTime + behaviorTime;
                if (totalTime < 1000) { // å°äº1ç§’è®¤ä¸ºæ€§èƒ½è‰¯å¥½
                    addResult(resultsDiv, 'âœ… æ€§èƒ½å½±å“åœ¨å¯æ¥å—èŒƒå›´å†…', 'success');
                } else {
                    addResult(resultsDiv, 'âš ï¸ æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œå»ºè®®ä¼˜åŒ–', 'warning');
                }
                
                log('æ€§èƒ½æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                addResult(resultsDiv, `âŒ æ€§èƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`æ€§èƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ˜¾ç¤ºä¿æŠ¤çŠ¶æ€
        function showProtectionStatus() {
            const resultsDiv = document.getElementById('anti-crawler-results');
            
            if (window.protectionInstance) {
                const status = window.protectionInstance.getProtectionStatus();
                
                addResult(resultsDiv, 'ğŸ“Š è¯¦ç»†ä¿æŠ¤çŠ¶æ€:', 'info');
                addResult(resultsDiv, `  ä¼šè¯ID: ${status.sessionId}`, 'info');
                addResult(resultsDiv, `  äººç±»è¯„åˆ†: ${status.humanScore.toFixed(2)}`, 'info');
                addResult(resultsDiv, `  äººç±»çŠ¶æ€: ${status.isHuman ? 'âœ… æ˜¯' : 'âŒ å¦'}`, status.isHuman ? 'success' : 'warning');
                addResult(resultsDiv, `  è¯·æ±‚æ€»æ•°: ${status.requestCount}`, 'info');
                addResult(resultsDiv, `  è¿è¡Œæ—¶é—´: ${(status.uptime / 1000).toFixed(1)}ç§’`, 'info');
                
                testStats.humanScore = status.humanScore;
            } else {
                addResult(resultsDiv, 'âŒ ä¿æŠ¤å®ä¾‹æœªæ‰¾åˆ°', 'error');
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const statsGrid = document.getElementById('stats-grid');
            
            const stats = [
                { label: 'æ€»è¯·æ±‚æ•°', value: testStats.totalRequests, color: '#2196F3' },
                { label: 'è¢«é˜»æ­¢è¯·æ±‚', value: testStats.blockedRequests, color: '#F44336' },
                { label: 'æ··æ·†å­—æ®µæ•°', value: testStats.obfuscatedFields, color: '#FF9800' },
                { label: 'äººç±»è¯„åˆ†', value: testStats.humanScore.toFixed(1), color: '#4CAF50' },
                { label: 'ä¿æŠ¤ç‡', value: `${((testStats.blockedRequests / Math.max(testStats.totalRequests, 1)) * 100).toFixed(1)}%`, color: '#9C27B0' },
                { label: 'æ—¥å¿—æ¡æ•°', value: testLogs.length, color: '#607D8B' }
            ];
            
            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-item">
                    <div class="stat-value" style="color: ${stat.color};">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }
        
        // æ¸…é™¤ç»Ÿè®¡
        function clearStats() {
            testStats = {
                totalRequests: 0,
                blockedRequests: 0,
                obfuscatedFields: 0,
                humanScore: 0
            };
            updateStats();
            log('ç»Ÿè®¡æ•°æ®å·²æ¸…é™¤', 'info');
        }
        
        // æ¸…é™¤æ—¥å¿—
        function clearLogs() {
            testLogs = [];
            document.getElementById('log-content').textContent = '';
            log('æ—¥å¿—å·²æ¸…é™¤');
        }
        
        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addResult(container, message, type) {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            container.appendChild(resultDiv);
        }
        
        // æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºä»¥æé«˜äººç±»è¯„åˆ†
        function simulateUserBehavior() {
            // æ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨
            document.dispatchEvent(new MouseEvent('mousemove', { clientX: Math.random() * 100, clientY: Math.random() * 100 }));
            
            // æ¨¡æ‹Ÿæ»šåŠ¨
            if (Math.random() < 0.3) {
                document.dispatchEvent(new Event('scroll'));
            }
            
            // æ¨¡æ‹Ÿç‚¹å‡»
            if (Math.random() < 0.1) {
                document.dispatchEvent(new MouseEvent('click'));
            }
        }
        
        // åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            log('ä¿æŠ¤ç³»ç»Ÿæµ‹è¯•é¢æ¿å·²åŠ è½½');
            updateStats();
            
            // å®šæœŸæ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸º
            setInterval(simulateUserBehavior, 1000);
            
            // å®šæœŸæ›´æ–°ç»Ÿè®¡
            setInterval(updateStats, 5000);
        });
        
        // é¡µé¢äº¤äº’äº‹ä»¶
        document.addEventListener('mousemove', () => {
            if (window.protectionInstance) {
                testStats.humanScore = window.protectionInstance.userBehavior.humanScore;
            }
        });
    </script>
</body>
</html> 