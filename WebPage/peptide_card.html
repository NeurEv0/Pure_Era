<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 预连接优化 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://unpkg.com">
    
    <!-- 关键CSS优先加载 -->
    <link rel="preload" href="../icon/iconfont.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- 图标和外部CSS -->
    <link rel="shortcut icon" href="../icon/favicon.ico">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- 回退样式表 -->
    <noscript>
        <link rel="stylesheet" href="../icon/iconfont.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </noscript>
    
    <title>SPADE Peptide Details</title>
    
    <!-- 延迟加载的脚本 -->
    <script>
        // 延迟加载非关键脚本
        window.addEventListener('load', function() {
            const scripts = [
                'https://unpkg.com/tranzy/dist/tranzy.umd.js',
                'anti-crawler-protection.js',
                'data-obfuscator.js',
                'quick-notes.js'
            ];
            
            scripts.forEach((src, index) => {
                setTimeout(() => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.async = true;
                    document.head.appendChild(script);
                }, index * 100);
            });
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900&display=swap');
        
        /* 现代清爽的配色方案 */
        :root {
            --primary-bg: #ffffff;
            --secondary-bg: #f8f9fa;
            --accent: #4f46e5;
            --accent-light: #6366f1;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border-light: #e5e7eb;
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.1);
            --backdrop: rgba(0, 0, 0, 0.4);
            --sidebar-bg: #f1f5f9;
            --hover-bg: #f8fafc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        html, body {
            min-height: 100vh;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            overflow-x: hidden;
        }

        /* 现代导航栏样式 */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-light);
            box-shadow: 0 1px 3px var(--shadow-light);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 24px;
            transition: all 0.3s ease;
        }

        .logo-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.5em;
            letter-spacing: 1px;
        }

        .nav-brand img {
            height: 32px;
            width: 32px;
            border-radius: 8px;
        }

        .nav-subtitle {
            color: var(--text-secondary);
            font-size: 0.6em;
            font-weight: 400;
            line-height: 1.2;
            margin-top: 2px;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
            list-style: none;
        }

        .nav-menu li {
            list-style: none;
        }

        .nav-menu a {
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            background: var(--hover-bg);
            color: var(--accent);
        }

        /* 移动端菜单按钮 */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5em;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .mobile-menu-btn:hover {
            background: var(--hover-bg);
            color: var(--accent);
        }

        /* 现代质感侧边栏 */
        .sidebar {
            position: fixed;
            top: 64px;
            left: 0;
            width: 280px;
            height: calc(100vh - 64px);
            background: linear-gradient(180deg, #ffffff 0%, #fafbfc 100%);
            border-right: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 2px 0 12px rgba(0, 0, 0, 0.04);
            z-index: 100;
            overflow-y: auto;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-nav {
            padding: 32px 0;
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 4px;
            padding: 0 16px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            text-decoration: none;
            color: #64748b;
            font-weight: 500;
            font-size: 14px;
            border-radius: 12px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .sidebar-nav a::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px 0 0 12px;
        }

        .sidebar-nav a:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--text-primary);
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .sidebar-nav a:hover::before {
            width: 4px;
        }

        .sidebar-nav a.active {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.08) 0%, rgba(99, 102, 241, 0.12) 100%);
            color: var(--accent);
            font-weight: 600;
            box-shadow: 0 2px 12px rgba(79, 70, 229, 0.15);
        }

        .sidebar-nav a.active::before {
            width: 4px;
        }

        .sidebar-nav .icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .sidebar-nav a:hover .icon {
            transform: scale(1.1);
        }

        .sidebar-nav .text {
            font-weight: inherit;
            letter-spacing: 0.01em;
        }

        /* 主内容区域 */
        .main-content {
            margin-left: 280px;
            margin-top: 64px;
            padding: 32px;
            min-height: calc(100vh - 64px);
            transition: margin-left 0.3s ease;
        }

        .content-wrapper {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* 现代语言选择器 */
        .language-selector {
            position: fixed;
            right: 24px;
            top: 76px;
            z-index: 1001;
        }

        .language-current {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            background: var(--primary-bg);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow-light);
            transition: all 0.2s ease;
        }

        .language-current i {
            font-size: 16px;
            color: var(--text-secondary);
            margin-right: 8px;
        }

        .language-current span {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .language-selector:hover .language-current {
            border-color: var(--accent-light);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        .language-options {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--primary-bg);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            box-shadow: 0 8px 24px var(--shadow-medium);
            min-width: 160px;
            margin-top: 4px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.2s ease;
        }

        .language-selector:hover .language-options {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .language-options a {
            display: block;
            padding: 8px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .language-options a:hover {
            background: var(--hover-bg);
            color: var(--accent);
        }

        /* 页面标题 */
        .page-title {
            color: var(--text-primary);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .top-nav {
                padding: 12px 16px;
            }

            .mobile-menu-btn {
                display: block;
            }

            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-top: 1px solid var(--border-light);
                flex-direction: column;
                align-items: center;
                padding: 16px 0;
                z-index: 1000;
                box-shadow: 0 4px 12px var(--shadow-medium);
            }

            .nav-menu.active {
                display: flex;
            }

            .nav-menu li {
                margin: 8px 0;
            }

            .nav-subtitle {
                display: none;
            }

            .logo-container .nav-subtitle {
                display: none;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 16px;
                margin-top: 64px;
            }

            .language-selector {
                top: 76px;
                right: 16px;
            }

            .page-title {
                font-size: 24px;
                margin-bottom: 24px;
            }

            .module {
                padding: 20px 16px;
                margin-bottom: 20px;
                border-radius: 12px;
            }

            .module-title {
                font-size: 18px;
                margin-bottom: 16px;
                padding-bottom: 12px;
            }

            .info-table {
                border-radius: 6px;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            .info-table th,
            .info-table td {
                padding: 10px 12px;
                font-size: 13px;
                min-width: 120px;
            }

            .info-table th {
                width: 140px;
                font-size: 12px;
            }

                        /* 移动端简化布局 - 只显示内容值 */
            @media (max-width: 768px) {
                .info-table {
                    border: none;
                    background: transparent;
                    box-shadow: none;
                }

                .info-table,
                .info-table tbody {
                    display: block;
                    width: 100%;
                }

                .info-table tr {
                    display: block;
                    background: #ffffff;
                    border: 1px solid rgba(0, 0, 0, 0.08);
                    border-radius: 8px;
                    margin-bottom: 12px;
                    padding: 16px;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
                    transition: box-shadow 0.2s ease;
                }

                .info-table tr:hover {
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                }

                .info-table th {
                    display: none;
                }

                .info-table td {
                    display: block;
                    width: 100%;
                    border: none;
                    padding: 0;
                    text-align: left;
                    min-height: auto;
                    word-wrap: break-word;
                    overflow-wrap: break-word;
                    font-size: 14px;
                    line-height: 1.6;
                    color: var(--text-primary);
                }

                .info-table td:before {
                    display: none;
                }

                     /* 移动端滚动内容优化 */
                     .scrollable-content {
                         max-height: 250px;
                         padding: 16px;
                         border-radius: 8px;
                     }

                     .organism-item {
                         padding: 10px 12px;
                         margin-bottom: 6px;
                         border-radius: 6px;
                     }

                     .organism-name {
                         font-size: 13px;
                     }

                     .organism-susceptibility {
                         font-size: 11px;
                         padding: 3px 6px;
                         min-width: 50px;
                     }

                     /* 活性标签移动端优化 */
                     .activity-tag {
                         padding: 6px 10px;
                         font-size: 11px;
                         margin: 2px 3px 2px 0;
                         display: inline-block;
                         max-width: 100%;
                         white-space: nowrap;
                         overflow: hidden;
                         text-overflow: ellipsis;
                     }

                     /* 序列显示移动端优化 */
                     .sequence {
                         padding: 12px 14px;
                         font-size: 12px;
                         letter-spacing: 1px;
                         border-radius: 8px;
                     }

                     /* 文献条目移动端优化 */
                     .literature-item {
                         padding: 16px;
                         margin-bottom: 16px;
                         border-radius: 12px;
                     }

                     .literature-buttons {
                         flex-direction: column;
                         gap: 8px;
                     }

                     .literature-link {
                         width: 100%;
                         justify-content: center;
                         padding: 10px 16px;
                     }
                 }

                 /* 超小屏幕额外优化 */
                 @media (max-width: 360px) {
                     .info-table tr {
                         padding: 12px;
                         margin-bottom: 10px;
                     }

                     .module {
                         padding: 16px 12px;
                     }

                     .module-title {
                         font-size: 16px;
                     }
                 }
             }

        /* 移动端覆盖层 */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--backdrop);
            z-index: 99;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-overlay.show {
            display: block;
            opacity: 1;
        }

        /* 现代全局滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.04);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.6) 0%, rgba(99, 102, 241, 0.7) 100%);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
        }

        /* 简约模块样式 */
        .module {
            background: #ffffff;
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
            transition: box-shadow 0.2s ease;
        }

        .module:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .module-title {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        .info-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 8px;
            overflow: hidden;
            background: #ffffff;
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .info-table td,
        .info-table th {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .info-table th {
            font-weight: 600;
            color: var(--text-primary);
            background: #f8fafc;
            width: 180px;
            font-size: 13px;
            border-right: 1px solid rgba(0, 0, 0, 0.08);
        }

        .info-table th:first-child {
            border-top-left-radius: 8px;
        }

        .info-table th:last-child {
            border-top-right-radius: 8px;
            border-right: none;
        }

        .info-table tbody tr {
            transition: background-color 0.15s ease;
        }

        .info-table tbody tr:hover {
            background: #f8fafc;
        }

        .info-table tbody tr:last-child td {
            border-bottom: none;
        }

        .info-table tbody tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }

        .info-table tbody tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }

        .info-table td {
            color: var(--text-primary);
            font-weight: 400;
            font-size: 14px;
            line-height: 1.5;
        }

        /* 错误和加载状态 */
        .error-message {
            color: #ef4444;
            font-size: 18px;
            text-align: center;
            margin: 100px auto;
            padding: 20px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-light);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        .loading-text {
            color: var(--text-muted);
            font-size: 14px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }





        /* 现代活性标签 */
        .activity-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin: 4px 6px 4px 0;
            box-shadow: 
                0 2px 4px rgba(79, 70, 229, 0.2),
                0 1px 2px rgba(0, 0, 0, 0.1);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.02em;
        }

        .activity-tag:hover {
            transform: translateY(-1px);
            box-shadow: 
                0 4px 8px rgba(79, 70, 229, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.15);
        }

        /* 现代序列显示 */
        .sequence {
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 16px 20px;
            border-radius: 12px;
            letter-spacing: 1.5px;
            font-size: 14px;
            line-height: 1.8;
            border: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 
                inset 0 1px 3px rgba(0, 0, 0, 0.06),
                0 1px 2px rgba(0, 0, 0, 0.04);
            overflow-x: auto;
            white-space: nowrap;
            color: #1e293b;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .sequence:hover {
            box-shadow: 
                inset 0 1px 3px rgba(0, 0, 0, 0.08),
                0 2px 8px rgba(0, 0, 0, 0.08);
        }

        /* 目标生物样式 */
        .organism-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .organism-item {
            display: flex;
            padding: 12px 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.04);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            margin-bottom: 4px;
        }
        
        .organism-item:hover {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.04) 0%, rgba(99, 102, 241, 0.06) 100%);
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .organism-item:last-child {
            border-bottom: none;
        }
        
        .organism-name {
            font-weight: 500;
            flex: 1;
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.4;
        }
        
        .organism-susceptibility {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(99, 102, 241, 0.15) 100%);
            color: var(--accent);
            font-weight: 600;
            margin-left: 12px;
            min-width: 60px;
            text-align: center;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            border: 1px solid rgba(79, 70, 229, 0.1);
        }
        

        
        /* 现代滚动内容 */
        .scrollable-content {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            box-shadow: 
                inset 0 1px 3px rgba(0, 0, 0, 0.04),
                0 1px 2px rgba(0, 0, 0, 0.02);
        }

        /* 现代滚动条样式 */
        .scrollable-content::-webkit-scrollbar {
            width: 8px;
        }

        .scrollable-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.04);
            border-radius: 4px;
            margin: 4px;
        }

        .scrollable-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .scrollable-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-light) 0%, var(--accent) 100%);
            box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
        }

        /* 快速笔记按钮 */
        .notes-trigger {
            transition: all 0.2s ease;
        }

        .notes-trigger:hover {
            opacity: 0.8;
        }

        /* 现代文献样式 */
        .literature-item {
            margin-bottom: 20px;
            padding: 24px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 16px;
            background: linear-gradient(145deg, #ffffff 0%, #fafbfc 100%);
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.06),
                0 2px 6px rgba(0, 0, 0, 0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .literature-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .literature-item:hover {
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.12),
                0 8px 24px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
            border-color: rgba(79, 70, 229, 0.1);
        }

        .literature-item:hover::before {
            opacity: 1;
        }

        .literature-item:last-child {
            margin-bottom: 0;
        }

        .literature-number {
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .literature-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .literature-author {
            margin-bottom: 8px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .literature-reference {
            font-style: italic;
            margin-bottom: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .literature-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .literature-link {
            color: white;
            text-decoration: none;
            font-weight: 600;
            border-radius: 8px;
            padding: 8px 16px;
            display: inline-flex;
            align-items: center;
            font-size: 13px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.01em;
        }
        
        .literature-link:hover {
            text-decoration: none;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* 3D结构查看器 */
        .structure-viewer {
            width: 100%;
            height: 300px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            margin: 12px 0;
            background: var(--secondary-bg);
        }
        
        .structure-link {
            display: inline-block;
            margin: 8px 0;
            padding: 8px 16px;
            background: var(--accent);
            color: white;
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .structure-link:hover {
            background: var(--accent-light);
        }
        
        .no-structure {
            padding: 24px;
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            border: 1px dashed rgba(0, 0, 0, 0.1);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- 采用search页面风格的导航栏 -->
    <nav class="top-nav">
        <div class="logo-container">
            <a href="#" class="nav-brand">
                <img src="../icon/logo.png" alt="SPADE Logo">
                SPADE
            </a>
            <div class="nav-subtitle">System for Antimicrobial Peptide<br>Management and Database</div>
        </div>
        
        <button class="mobile-menu-btn" id="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </button>
        
        <ul class="nav-menu">
            <li><a href="home.html">Home</a></li>
            <li><a href="search.html">Search</a></li>
            <li><a href="tools.html">Tools</a></li>
            <li><a href="statistics.html">Statistics</a></li>
            <li><a href="#" id="quick-notes-btn" title="Quick Notes">
                <i class="fas fa-sticky-note"></i>
            </a></li>
        </ul>
    </nav>

    <!-- 语言选择器 -->
    <div class="language-selector">
        <div class="language-current" id="currentLang">
            <i class="fas fa-globe"></i>
            <span id="currentLangText">English</span>
        </div>
        <div class="language-options">
            <a href="#" data-lang="en" class="no-translate">English</a>
            <a href="#" data-lang="zh-Hans" class="no-translate">中文 (简体)</a>
            <a href="#" data-lang="zh-Hant" class="no-translate">繁體中文</a>
            <a href="#" data-lang="ja" class="no-translate">日本語</a>
            <a href="#" data-lang="ko" class="no-translate">한국어</a>
            <a href="#" data-lang="fr" class="no-translate">Français</a>
            <a href="#" data-lang="de" class="no-translate">Deutsch</a>
            <a href="#" data-lang="es" class="no-translate">Español</a>
            <a href="#" data-lang="ru" class="no-translate">Русский</a>
        </div>
    </div>

    <!-- 简约侧边栏 -->
    <aside class="sidebar" id="sidebar">
        <ul class="sidebar-nav">
            <li>
                <a href="#general" class="active">
                    <span class="icon"><i class="fas fa-info-circle"></i></span>
                    <span class="text">General Information</span>
                </a>
            </li>
            <li>
                <a href="#activity">
                    <span class="icon"><i class="fas fa-flask"></i></span>
                    <span class="text">Activity Information</span>
                </a>
            </li>
            <li>
                <a href="#structure">
                    <span class="icon"><i class="fas fa-dna"></i></span>
                    <span class="text">Structural Information</span>
                </a>
            </li>
            <li>
                <a href="#properties">
                    <span class="icon"><i class="fas fa-atom"></i></span>
                    <span class="text">Physicochemical Properties</span>
                </a>
            </li>
            <li>
                <a href="#comments">
                    <span class="icon"><i class="fas fa-comment"></i></span>
                    <span class="text">Comments Information</span>
                </a>
            </li>
            <li>
                <a href="#literature">
                    <span class="icon"><i class="fas fa-book"></i></span>
                    <span class="text">Literature Information</span>
                </a>
            </li>
            <li>
                <a href="search.html">
                    <span class="icon"><i class="fas fa-arrow-left"></i></span>
                    <span class="text">Back to Search</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- 移动端覆盖层 -->
    <div class="mobile-overlay" id="mobile-overlay"></div>

    <!-- 主内容区域 -->
    <main class="main-content">
        <div class="content-wrapper">
            <h1 class="page-title" id="peptide-name">Loading...</h1>
            
            <!-- 动态生成的模块容器 -->
            <div id="module-container"></div>
        </div>
    </main>

    

    <script>
        // 简化的导航功能
        class SimpleNavigation {
            constructor() {
                this.sidebar = document.getElementById('sidebar');
                this.mobileMenuBtn = document.getElementById('mobile-menu-btn');
                this.mobileOverlay = document.getElementById('mobile-overlay');
                this.sidebarNavLinks = document.querySelectorAll('.sidebar-nav a');
                
                this.init();
            }

            init() {
                this.bindEvents();
                this.initLanguageSelector();
            }

            bindEvents() {
                // 移动端菜单切换
                this.mobileMenuBtn?.addEventListener('click', () => {
                    this.toggleSidebar();
                });

                // 覆盖层点击关闭
                this.mobileOverlay?.addEventListener('click', () => {
                    this.closeSidebar();
                });

                // 侧边栏导航点击
                this.sidebarNavLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.setActiveNav(link);
                        
                        // 如果是锚点链接，平滑滚动
                        const href = link.getAttribute('href');
                        if (href.startsWith('#')) {
                            this.scrollToSection(href);
                        } else {
                            window.location.href = href;
                        }
                        
                        // 移动端点击后关闭侧边栏
                        if (window.innerWidth <= 768) {
                            this.closeSidebar();
                        }
                    });
                });

                // 窗口大小变化
                window.addEventListener('resize', () => {
                    if (window.innerWidth > 768) {
                        this.closeSidebar();
                    }
                });
            }

            toggleSidebar() {
                this.sidebar.classList.toggle('open');
                this.mobileOverlay.classList.toggle('show');
            }

            closeSidebar() {
                this.sidebar.classList.remove('open');
                this.mobileOverlay.classList.remove('show');
            }

            setActiveNav(activeLink) {
                this.sidebarNavLinks.forEach(link => {
                    link.classList.remove('active');
                });
                activeLink.classList.add('active');
            }

            scrollToSection(sectionId) {
                const element = document.querySelector(sectionId);
                if (element) {
                    element.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }

            initLanguageSelector() {
                const langOptions = document.querySelectorAll('.language-options a');
                langOptions.forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.preventDefault();
                        const newLang = option.getAttribute('data-lang');
                        this.changeLanguage(newLang);
                    });
                });
            }

            changeLanguage(lang) {
                const langDisplay = {
                    'en': 'English',
                    'zh-Hans': '中文 (简体)',
                    'zh-Hant': '繁體中文',
                    'ja': '日本語',
                    'ko': '한국어',
                    'fr': 'Français',
                    'de': 'Deutsch',
                    'es': 'Español',
                    'ru': 'Русский'
                };
                
                document.getElementById('currentLangText').textContent = langDisplay[lang];
                localStorage.setItem('preferredLanguage', lang);
                
                // 重新加载页面以应用语言更改
                const currentUrl = new URL(window.location.href);
                currentUrl.searchParams.set('ts', Date.now());
                window.location.href = currentUrl.toString();
            }
        }

        // 初始化导航
        let navigation;
        document.addEventListener('DOMContentLoaded', () => {
            navigation = new SimpleNavigation();
            
            // 快速笔记按钮事件处理
            const notesBtn = document.getElementById('quick-notes-btn');
            if (notesBtn) {
                notesBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (window.quickNotes) {
                        window.quickNotes.toggle();
                    }
                });
            }
        });

        // --- 高效的数据查找辅助函数 ---
        class DataFinder {
            constructor(data) {
                this.data = data;
                this.cache = new Map();
                this.pathCache = new Map();
                this.initializeFieldMap();
            }

            // 初始化字段映射，预计算常用字段路径
            initializeFieldMap() {
                this.fieldPaths = new Map();
                this.flattenData(this.data, []);
            }

            // 展平数据结构，建立字段路径映射
            flattenData(obj, path) {
                if (obj === null || obj === undefined) return;

                if (Array.isArray(obj)) {
                    obj.forEach((item, index) => {
                        this.flattenData(item, [...path, index]);
                    });
                } else if (typeof obj === 'object') {
                    Object.entries(obj).forEach(([key, value]) => {
                        const currentPath = [...path, key];
                        
                        // 存储字段路径
                        if (!this.fieldPaths.has(key)) {
                            this.fieldPaths.set(key, []);
                        }
                        this.fieldPaths.get(key).push({
                            path: currentPath,
                            value: value
                        });

                        // 递归处理嵌套对象
                        if (value && typeof value === 'object') {
                            this.flattenData(value, currentPath);
                        }
                    });
                }
            }

            // 高效查找字段值
            findValue(targetKey) {
                // 检查缓存
                if (this.cache.has(targetKey)) {
                    return this.cache.get(targetKey);
                }

                let result = null;

                // 首先尝试直接字段匹配
                if (this.fieldPaths.has(targetKey)) {
                    const matches = this.fieldPaths.get(targetKey);
                    if (matches.length > 0) {
                        // 返回第一个匹配的值
                        result = matches[0].value;
                    }
                }

                // 如果没找到，尝试大小写不敏感匹配
                if (result === null) {
                    const lowerKey = targetKey.toLowerCase();
                    for (const [key, matches] of this.fieldPaths.entries()) {
                        if (key.toLowerCase() === lowerKey && matches.length > 0) {
                            result = matches[0].value;
                            break;
                        }
                    }
                }

                // 如果还是没找到，尝试包含匹配
                if (result === null) {
                    const searchKey = targetKey.toLowerCase();
                    for (const [key, matches] of this.fieldPaths.entries()) {
                        if (key.toLowerCase().includes(searchKey) && matches.length > 0) {
                            result = matches[0].value;
                            break;
                        }
                    }
                }

                // 缓存结果
                this.cache.set(targetKey, result);
                return result;
            }

            // 检查字段是否存在
            hasField(targetKey) {
                return this.findValue(targetKey) !== null;
            }
        }

        // 兼容性包装函数
        function findValueInObject(data, targetKey) {
            if (!data) return null;
            const finder = new DataFinder(data);
            return finder.findValue(targetKey);
        }

        // 改进的 URL 参数解析
        function getPeptideIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
            
            // 尝试多种可能的参数名
            const possibleParams = ['DRAMP ID', 'DRAMP_ID', 'id', 'peptideId', 'DRAMP_OTD'];
            
            for (const param of possibleParams) {
                const value = urlParams.get(param);
                if (value) {
                    console.log(`找到参数 ${param}: ${value}`);
                    // 处理可能的格式：DRAMP00004 或 DRAMP00004:1520
                    return value.split(':')[0].trim();
                }
            }
            
            return null;
        }

        // 主初始化函数
        function initializeApplication() {
            console.log('开始初始化应用...');
            
            // 首先初始化缓存系统
            try {
                initializeCache();
                console.log('缓存系统初始化成功');
            } catch (error) {
                console.error('缓存系统初始化失败:', error);
            }
            
            // 执行调试信息
            setTimeout(debugInfo, 500);
            
            // 获取 peptideId
            const peptideId = getPeptideIdFromUrl();
            
            console.log('解析的 peptideId:', peptideId);
            console.log('当前 URL:', window.location.href);
        
        // 检查 peptideId 是否有效
        if (!peptideId) {
            console.error('无法从URL获取有效的 Peptide ID');
                console.log('URL参数:', window.location.search);
            // 显示错误信息
                showErrorMessage('Invalid or missing Peptide ID in URL. Please check the URL parameters.');
        } else {
            const DATA_URL = `./Database/${peptideId}.json`;
                console.log('数据文件路径:', DATA_URL);
            // 使用受保护的数据加载方式
            loadProtectedData(DATA_URL, peptideId);
            }
        }
        
        // 等待DOM加载完成后初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApplication);
        } else {
            // DOM 已经加载完成
            initializeApplication();
        }

        // 统一的错误信息显示函数
        function showErrorMessage(message) {
            const titleElement = document.getElementById('peptide-name');
            const containerElement = document.getElementById('module-container');
            
            if (titleElement) {
                titleElement.textContent = '';
            }
            
            if (containerElement) {
                const errorMsg = document.createElement('div');
                errorMsg.className = 'error-message fade-in';
                errorMsg.textContent = message;
                errorMsg.setAttribute('data-translate', '');
                containerElement.innerHTML = '';
                containerElement.appendChild(errorMsg);
            }
        }

        // 数据缓存系统 - 使用单例模式确保安全初始化
        class DataCache {
            constructor() {
                this.cache = new Map();
                this.maxCacheSize = 10;
                this.cacheAge = 5 * 60 * 1000; // 5分钟缓存
                console.log('DataCache 初始化完成');
            }

            set(key, data) {
                if (this.cache.size >= this.maxCacheSize) {
                    const firstKey = this.cache.keys().next().value;
                    this.cache.delete(firstKey);
                }
                this.cache.set(key, {
                    data: data,
                    timestamp: Date.now()
                });
                console.log(`缓存数据: ${key}`);
            }

            get(key) {
                const cached = this.cache.get(key);
                if (!cached) {
                    console.log(`缓存未命中: ${key}`);
                    return null;
                }
                
                if (Date.now() - cached.timestamp > this.cacheAge) {
                    this.cache.delete(key);
                    console.log(`缓存过期: ${key}`);
                    return null;
                }
                
                console.log(`缓存命中: ${key}`);
                return cached.data;
            }

            static getInstance() {
                if (!DataCache.instance) {
                    DataCache.instance = new DataCache();
                }
                return DataCache.instance;
            }
        }

        // 初始化缓存系统 - 使用单例模式
        function initializeCache() {
            return DataCache.getInstance();
        }

        // 获取缓存实例
        function getCache() {
            return DataCache.getInstance();
        }

        // 显示加载状态
        function showLoadingState() {
            const container = document.getElementById('module-container');
            container.innerHTML = `
                <div class="loading-container">
                    <div class="loading-dots">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                    <div class="loading-text" data-translate="">Loading peptide data...</div>
                </div>
            `;
        }

        // 显示骨架屏
        function showSkeletonScreen() {
            const container = document.getElementById('module-container');
            const skeletonHTML = `
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton skeleton-table"></div>
                <div class="skeleton skeleton-table"></div>
                <div class="skeleton skeleton-table"></div>
            `;
            container.innerHTML = skeletonHTML;
        }

        // 优化的受保护数据加载函数
        async function loadProtectedData(dataUrl, peptideId) {
            console.log('开始加载数据:', { dataUrl, peptideId });
            
            // 显示加载状态
            showLoadingState();
            
            try {
                // 获取缓存实例
                const cache = getCache();
                
                // 检查缓存
                const cachedData = cache.get(peptideId);
                if (cachedData) {
                    console.log('从缓存加载数据');
                    renderPeptide(cachedData);
                    return;
                }

                console.log('从网络加载数据...');
                
                // 简化保护组件检查逻辑
                const waitForProtection = () => {
                    return new Promise(resolve => {
                        // 如果保护组件不存在，直接继续
                if (!window.protectionInstance) {
                            console.log('保护组件未加载，跳过保护检查');
                            resolve();
                            return;
                        }
                        
                        const checkProtection = () => {
                            if (window.protectionInstance.isReady) {
                                console.log('保护组件已就绪');
                                resolve();
                            } else {
                                setTimeout(checkProtection, 50);
                            }
                        };
                        checkProtection();
                    });
                };

                // 使用 fetch 获取数据，添加更好的错误处理
                const fetchData = async () => {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000);
                    
                    try {
                        const response = await fetch(dataUrl, {
                            signal: controller.signal,
                            cache: 'no-cache', // 确保获取最新数据
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        clearTimeout(timeoutId);
                        
                        console.log('HTTP响应状态:', response.status);
                
                if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                        console.log('数据解析成功，数据大小:', JSON.stringify(data).length, '字符');
                        return data;
                        
                    } catch (fetchError) {
                        clearTimeout(timeoutId);
                        throw fetchError;
                    }
                };

                // 并行进行保护检查和数据获取
                const [, data] = await Promise.all([
                    waitForProtection(),
                    fetchData()
                ]);
                
                // 移除保护元数据（如果存在）
                const cleanData = cleanProtectedData(data);
                
                // 缓存数据
                cache.set(peptideId, cleanData);
                
                console.log('数据加载完成，开始渲染');
                renderPeptide(cleanData);
                
            } catch (error) {
                console.error('数据加载或解析失败:', error);
                console.error('错误详情:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
                handleLoadingError(error, peptideId);
            }
        }

        // 错误处理函数
        function handleLoadingError(error, peptideId) {
            let errorMessage = 'Data loading failed.';
                
                // 根据错误类型显示不同的消息
            if (error.name === 'AbortError') {
                errorMessage = 'Request timeout. Please check your connection and try again.';
            } else if (error instanceof SyntaxError) {
                errorMessage = 'Failed to parse data. Invalid JSON format.';
            } else if (error.message.includes('HTTP 404')) {
                errorMessage = `Data file not found: ${peptideId}.json. Please verify the peptide ID.`;
            } else if (error.message.includes('HTTP 500')) {
                errorMessage = 'Server error. Please try again later.';
            } else if (error.message.includes('HTTP')) {
                errorMessage = `Network error: ${error.message}`;
                } else if (error.message.includes('访问被限制') || error.message.includes('请求频率')) {
                errorMessage = 'Access temporarily limited. Please try again in a moment.';
            } else if (error.message.includes('fetch')) {
                errorMessage = 'Network connection failed. Please check your internet connection.';
                } else {
                errorMessage = `Unexpected error: ${error.message}`;
            }
            
            console.log('显示错误信息:', errorMessage);
            showErrorMessage(errorMessage);
            
            // 添加重试按钮
            setTimeout(() => {
                const container = document.getElementById('module-container');
                if (container && container.querySelector('.error-message')) {
                    const retryButton = document.createElement('button');
                    retryButton.textContent = 'Retry';
                    retryButton.className = 'retry-button';
                    retryButton.style.cssText = `
                        margin-top: 15px;
                        padding: 10px 20px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                        transition: all 0.3s ease;
                    `;
                    
                    retryButton.addEventListener('click', () => {
                        console.log('重试加载数据...');
                        const DATA_URL = `./Database/${peptideId}.json`;
                        loadProtectedData(DATA_URL, peptideId);
                    });
                    
                    retryButton.addEventListener('mouseenter', () => {
                        retryButton.style.transform = 'translateY(-2px)';
                        retryButton.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
                    });
                    
                    retryButton.addEventListener('mouseleave', () => {
                        retryButton.style.transform = 'translateY(0)';
                        retryButton.style.boxShadow = 'none';
                    });
                    
                    container.querySelector('.error-message').appendChild(retryButton);
                }
            }, 500);
        }

        // 清理保护数据函数
        function cleanProtectedData(data) {
            if (data && typeof data === 'object') {
                const cleanData = { ...data };
                delete cleanData._metadata;
                return cleanData;
            }
            return data;
        }

        // 调试工具函数
        function debugInfo() {
            console.log('=== 调试信息 ===');
            console.log('当前URL:', window.location.href);
            console.log('URL参数:', window.location.search);
            console.log('解析的peptideId:', getPeptideIdFromUrl());
            
            try {
                const cache = getCache();
                console.log('dataCache状态:', cache ? '已初始化' : '未初始化');
            } catch (error) {
                console.log('dataCache状态: 初始化失败 -', error.message);
            }
            
            console.log('protectionInstance状态:', window.protectionInstance ? '存在' : '不存在');
            
            // 检查Database目录是否可访问
            fetch('./Database/').then(response => {
                console.log('Database目录访问状态:', response.status);
            }).catch(error => {
                console.log('Database目录访问失败:', error.message);
            });
            
            console.log('===============');
        }

        // 检查值是否为有效信息
        function isValidValue(value) {
            if (value === null || value === undefined || value === '') {
                return false;
            }
            
            // 检查字符串类型的无效值
            if (typeof value === 'string') {
                const invalidStrings = [
                    'not found',
                    'not include',
                    'not included yet',
                    'no entry found',
                    'no hemolysis information',
                    'no cytotoxicity information',
                    'there is no predicted structure',
                    'none',
                    'no mics found',
                    'no data found',
                    'reference(s) presented',
                    'dramp database'
                ];
                
                const lowerValue = value.toLowerCase().trim();
                
                // 检查是否包含无效关键词
                if (invalidStrings.some(invalid => lowerValue.includes(invalid))) {
                    return false;
                }
                
                // 检查是否只是空白字符
                if (lowerValue === '') {
                    return false;
                }
                
                return true;
            }
            
            // 检查数组是否为空或包含无效数据
            if (Array.isArray(value)) {
                // 检查数组是否为空
                if (value.length === 0) {
                    return false;
                }
                
                // 检查数组中是否都是有效数据
                return value.some(item => {
                    if (typeof item === 'string') {
                        const itemLower = item.toLowerCase().trim();
                        return itemLower !== '' && 
                               !itemLower.includes('not found') && 
                               !itemLower.includes('not include');
                    } else if (typeof item === 'object' && item !== null) {
                        // 对于文献对象，检查是否有有效的标题或作者
                        return (item.Title && item.Title.trim() !== '') || 
                               (item.Author && item.Author.trim() !== '');
                    }
                    return true;
                });
            }
            
            return true;
        }

        // 改进的数据查找函数，支持多层级数据结构和各种字段名变体
        function findFieldValue(data, fieldName) {
            if (!data || typeof data !== 'object') {
                return undefined;
            }
            
            // 直接查找
            if (data[fieldName] !== undefined && data[fieldName] !== null && data[fieldName] !== '') {
                return data[fieldName];
            }
            
            // 特殊字段映射 - 处理同义词和变体
            const fieldMappings = {
                'PTM': ['ptm', 'PTM', 'Ptm'],
                'Comment': ['Comment', 'comment', 'Comments', 'comments'],
                'Biophysicochemical properties': ['Biophysicochemical properties', 'biophysicochemical properties', 'Biophysicochemical Properties']
            };
            
            if (fieldMappings[fieldName]) {
                for (const variant of fieldMappings[fieldName]) {
                    if (data[variant] !== undefined && data[variant] !== null && data[variant] !== '') {
                        return data[variant];
                    }
                }
            }
            
            // 在Sequence Information中查找
            if (data['Sequence Information']) {
                const seqInfo = data['Sequence Information'];
                if (seqInfo[fieldName] !== undefined && seqInfo[fieldName] !== null && seqInfo[fieldName] !== '') {
                    return seqInfo[fieldName];
                }
                
                // 在Sequence Information中查找字段变体
                if (fieldMappings[fieldName]) {
                    for (const variant of fieldMappings[fieldName]) {
                        if (seqInfo[variant] !== undefined && seqInfo[variant] !== null && seqInfo[variant] !== '') {
                            return seqInfo[variant];
                        }
                    }
                }
            }
            
            // 在Clinical Information中查找
            if (data['Clinical Information'] && Array.isArray(data['Clinical Information'])) {
                for (const item of data['Clinical Information']) {
                    if (typeof item === 'object' && item[fieldName] !== undefined) {
                        return item[fieldName];
                    }
                }
            }
            
            // 在Patent Information中查找
            if (data['Patent Information'] && Array.isArray(data['Patent Information'])) {
                for (const item of data['Patent Information']) {
                    if (typeof item === 'object' && item[fieldName] !== undefined) {
                        return item[fieldName];
                    }
                }
            }
            
            // 递归查找所有层级，但跳过已处理的特殊键
            const skipKeys = ['Sequence Information', 'Clinical Information', 'Patent Information'];
            for (const key in data) {
                if (!skipKeys.includes(key) && typeof data[key] === 'object' && data[key] !== null && !Array.isArray(data[key])) {
                    const result = findFieldValue(data[key], fieldName);
                    if (result !== undefined && result !== null && result !== '') {
                        return result;
                    }
                }
            }
            
            return undefined;
        }

        // 收集所有可用字段的函数
        function getAllAvailableFields(data, prefix = '') {
            const fields = new Set();
            
            if (!data || typeof data !== 'object') {
                return fields;
            }
            
            for (const key in data) {
                const fullKey = prefix ? `${prefix}.${key}` : key;
                fields.add(key); // 添加当前键
                
                if (typeof data[key] === 'object' && data[key] !== null && !Array.isArray(data[key])) {
                    // 递归获取嵌套对象的字段
                    const nestedFields = getAllAvailableFields(data[key], fullKey);
                    nestedFields.forEach(field => fields.add(field));
                } else if (Array.isArray(data[key]) && data[key].length > 0 && typeof data[key][0] === 'object') {
                    // 处理对象数组
                    const nestedFields = getAllAvailableFields(data[key][0], fullKey);
                    nestedFields.forEach(field => fields.add(field));
                }
            }
            
            return fields;
        }

        // 优化的文档片段渲染函数
        function renderPeptide(peptide) {
            console.log('完整的肽数据结构:', peptide); // 调试日志
            
            // 性能计时开始
            const startTime = performance.now();
            
            // 显示所有可用字段
            const allFields = getAllAvailableFields(peptide);
            console.log('所有可用字段:', Array.from(allFields).sort());
            
            const pageTitle = document.getElementById('peptide-name');
            // 使用改进的查找函数
            const peptideName = findFieldValue(peptide, 'Peptide Name');
            pageTitle.textContent = peptideName || 'Unknown Peptide';

            const modules = [
                { id: 'general', title: 'General Information', fields: [
                    'DRAMP ID', 'Peptide Name', 'Source', 'Family', 'Sequence Length', 'Biological Activity',
                    'Gene', 'Sequence', 'UniProt Entry', 'Protein Existence'
                ]},
                { id: 'activity', title: 'Activity Information', fields: [
                    'Biological Activity', 'Target Organism', 'Hemolytic Activity',
                    'Cytotoxicity', 'Binding Target'
                ]},
                { id: 'structure', title: 'Structural Information', fields: [
                    'Linear/Cyclic', 'N-terminal Modification', 'C-terminal Modification',
                    'Nonterminal Modifications and Unusual Amino Acids', 'Stereochemistry',
                    'Structure', 'Structure Description', 'Helical Wheel Diagram',
                    'PDB ID', 'Predicted Structure'
                ]},
                { id: 'properties', title: 'Physico-Chemical Properties', fields: [
                    'Formula', 'Absent Amino Acids', 'Common Amino Acids', 'Mass', 'PI',
                    'Basic Residues', 'Acidic Residues', 'Hydrophobic Residues', 'Net Charge',
                    'Boman Index', 'Hydrophobicity', 'Aliphatic Index', 'Half Life',
                    'Extinction Coefficient Cystines', 'Absorbance 280nm', 'Polar Residues'
                ]},
                { id: 'comments', title: 'Comments Information', fields: [
                    'Function', 'PTM', 'Comment', 'Biophysicochemical properties', 'target_organisms'
                ]},
                { id: 'literature', title: 'Literature Information', fields: [
                    'Literature'
                ]}
            ];

            // 使用文档片段优化DOM操作
            const moduleContainer = document.getElementById('module-container');
            const fragment = document.createDocumentFragment();
            
            modules.forEach(moduleConfig => {
                // 先检查这个模块是否有任何有效字段
                const validFields = moduleConfig.fields.filter(field => {
                    const value = findFieldValue(peptide, field);
                    return isValidValue(value);
                });

                // 如果没有有效字段，跳过整个模块
                if (validFields.length === 0) {
                    console.log(`模块 "${moduleConfig.title}" 没有有效数据，跳过显示`);
                    return;
                }

                const module = document.createElement('div');
                module.className = 'module';
                module.id = moduleConfig.id;

                const moduleTitle = document.createElement('h3');
                moduleTitle.className = 'module-title';
                moduleTitle.textContent = moduleConfig.title;
                moduleTitle.setAttribute('data-translate', ''); // 标记为需要翻译
                module.appendChild(moduleTitle);

                const table = document.createElement('table');
                table.className = 'info-table';

                moduleConfig.fields.forEach(field => {
                    let value = findFieldValue(peptide, field);
                    
                    // 检查值是否有效，如果无效则跳过此字段
                    if (!isValidValue(value)) {
                        console.log(`字段 "${field}" 无有效数据，跳过显示`);
                        return; // 跳过这个字段，不渲染这一行
                    }

                    const row = document.createElement('tr');
                    const th = document.createElement('th');
                    th.textContent = field;
                    th.setAttribute('data-translate', ''); // 标记为需要翻译
                    row.appendChild(th);

                    const td = document.createElement('td');

                    // 特殊处理Target Organism字段，以分隔的形式展示
                    if (field === 'Target Organism' && value) {
                        // 创建可滚动容器
                        const scrollContainer = document.createElement('div');
                        scrollContainer.className = 'scrollable-content';
                        
                        const organismList = document.createElement('ul');
                        organismList.className = 'organism-list';
                        
                        // 如果是长字符串，尝试解析为更友好的格式
                        if (typeof value === 'string') {
                            // 处理特殊格式：添加说明标题
                            if (value.includes('Note:')) {
                                // 分离注释和主要内容
                                const parts = value.split('Note:');
                                const mainContent = parts[0].trim();
                                const note = 'Note:' + parts[1].trim();
                                
                                // 处理主要内容部分
                                processOrganismString(mainContent, organismList);
                                
                                // 添加注释作为单独的项
                                const noteItem = document.createElement('li');
                                noteItem.className = 'organism-item';
                                noteItem.style.fontStyle = 'italic';
                                noteItem.style.marginTop = '10px';
                                noteItem.style.color = '#666';
                                noteItem.textContent = note;
                                noteItem.setAttribute('data-translate', ''); // 标记为需要翻译
                                organismList.appendChild(noteItem);
                            } else {
                                // 处理普通格式
                                processOrganismString(value, organismList);
                            }
                        }
                        
                        scrollContainer.appendChild(organismList);
                        td.appendChild(scrollContainer);
                    }
                    // 特殊处理target_organisms字段（处理结构化的目标生物数据）
                    else if (field === 'target_organisms' && value && Array.isArray(value)) {
                        const scrollContainer = document.createElement('div');
                        scrollContainer.className = 'scrollable-content';
                        
                        const organismList = document.createElement('ul');
                        organismList.className = 'organism-list';
                        
                        value.forEach(organism => {
                            if (typeof organism === 'object' && organism.name) {
                                const organismItem = document.createElement('li');
                                organismItem.className = 'organism-item';
                                
                                const nameSpan = document.createElement('span');
                                nameSpan.className = 'organism-name';
                                nameSpan.textContent = organism.name;
                                nameSpan.setAttribute('data-translate', '');
                                organismItem.appendChild(nameSpan);
                                
                                if (organism.activity) {
                                    const activitySpan = document.createElement('span');
                                    activitySpan.className = 'organism-susceptibility';
                                    activitySpan.textContent = organism.activity;
                                    
                                    // 根据活性强度设置颜色
                                    const plusCount = (organism.activity.match(/\\+/g) || []).length;
                                    if (plusCount >= 4) {
                                        activitySpan.style.color = '#d32f2f'; // 极高活性红色
                                    } else if (plusCount >= 3) {
                                        activitySpan.style.color = '#4CAF50'; // 高活性绿色
                                    } else if (plusCount >= 2) {
                                        activitySpan.style.color = '#2196F3'; // 中等活性蓝色
                                    } else if (plusCount >= 1) {
                                        activitySpan.style.color = '#FFC107'; // 低活性黄色
                                    }
                                    
                                    organismItem.appendChild(activitySpan);
                                }
                                
                                organismList.appendChild(organismItem);
                            }
                        });
                        
                        scrollContainer.appendChild(organismList);
                        td.appendChild(scrollContainer);
                    }
                    // 特殊处理序列字段，应用新样式
                    else if (field === 'Sequence' && value) {
                        const sequenceElem = document.createElement('div');
                        sequenceElem.className = 'sequence';
                        sequenceElem.textContent = value;
                        sequenceElem.classList.add('no-translate'); // 序列不应被翻译
                        td.appendChild(sequenceElem);
                    }
                    // 特殊处理生物活性字段，应用标签样式
                    else if (field === 'Biological Activity' && value) {
                        if (Array.isArray(value)) {
                            value.forEach(activity => {
                                const tag = document.createElement('span');
                                tag.className = 'activity-tag';
                                tag.textContent = activity;
                                tag.setAttribute('data-translate', ''); // 标记为需要翻译
                                td.appendChild(tag);
                            });
                        } else {
                            const tag = document.createElement('span');
                            tag.className = 'activity-tag';
                            tag.textContent = value;
                            tag.setAttribute('data-translate', ''); // 标记为需要翻译
                            td.appendChild(tag);
                        }
                    }
                    // 特殊处理结构字段，添加3D结构查看器
                    else if ((field === 'Structure' || field === 'Predicted Structure' || field === 'PDB ID') && value) {
                        if (field === 'PDB ID' && value !== 'None' && value !== 'Not found') { // Added 'Not found' check
                            // 为PDB ID创建链接和嵌入式查看器
                            const pdbLink = document.createElement('a');
                            pdbLink.href = `https://www.rcsb.org/structure/${value}`;
                            pdbLink.textContent = value;
                            pdbLink.target = '_blank';
                            pdbLink.rel = 'noopener noreferrer';
                            pdbLink.className = 'structure-link';
                            td.appendChild(pdbLink);
                            
                            // 添加3D结构查看器
                            const viewerContainer = document.createElement('div');
                            viewerContainer.className = 'structure-viewer';
                            
                            const viewer = document.createElement('iframe');
                            viewer.src = `https://www.rcsb.org/3d-view?id=${value}`;
                            viewer.width = '100%';
                            viewer.height = '100%';
                            viewer.frameBorder = '0';
                            viewerContainer.appendChild(viewer);
                            
                            td.appendChild(viewerContainer);
                        } else if ((field === 'Structure' || field === 'Predicted Structure') && typeof value === 'string' && value.toLowerCase().startsWith('http')) {
                            // 处理结构URL
                            const structureLink = document.createElement('a');
                            structureLink.href = value;
                            structureLink.textContent = 'View Structure';
                            structureLink.target = '_blank';
                            structureLink.rel = 'noopener noreferrer';
                            structureLink.className = 'structure-link';
                            structureLink.setAttribute('data-translate', '');
                            td.appendChild(structureLink);
                        } else if (value === 'None' || value === 'Not found' || (field === 'PDB ID' && (value === 'None' || value === 'Not found'))) {
                            const noStructure = document.createElement('div');
                            noStructure.className = 'no-structure';
                            noStructure.textContent = 'No structure available';
                            noStructure.setAttribute('data-translate', '');
                            td.appendChild(noStructure);
                        } else { // Fallback for other string values in structure fields
                            const textElem = document.createElement('span');
                            textElem.textContent = value;
                            if (typeof value === 'string') { // Ensure translation only for strings
                                textElem.setAttribute('data-translate', '');
                            }
                            td.appendChild(textElem);
                        }
                    }
                    // **** MOVED AND CORRECTED LITERATURE HANDLER ****
                    else if (field === 'Literature') {
                        // 'value' already contains the literature data from findFieldValue
                        console.log('Literature field processing. Value:', value, 'Type:', typeof value); 

                        if (value && Array.isArray(value) && value.length > 0) {
                            value.forEach((item, index) => {
                                if (typeof item === 'object' && item !== null) {
                                    const literatureDiv = document.createElement('div');
                                    literatureDiv.className = 'literature-item';
                                    
                                    const numberElem = document.createElement('div');
                                    numberElem.className = 'literature-number';
                                    numberElem.textContent = `[${index + 1}]`;
                                    literatureDiv.appendChild(numberElem);
                                    
                                    if (item.Title) {
                                        const titleElem = document.createElement('div');
                                        titleElem.className = 'literature-title';
                                        titleElem.textContent = item.Title;
                                        titleElem.setAttribute('data-translate', '');
                                        literatureDiv.appendChild(titleElem);
                                    }
                                    
                                    if (item.Author) {
                                        const authorElem = document.createElement('div');
                                        authorElem.className = 'literature-author';
                                        authorElem.textContent = item.Author;
                                        authorElem.setAttribute('data-translate', '');
                                        literatureDiv.appendChild(authorElem);
                                    }
                                    
                                    if (item.Reference) {
                                        const refElem = document.createElement('div');
                                        refElem.className = 'literature-reference';
                                        refElem.textContent = item.Reference;
                                        literatureDiv.appendChild(refElem);
                                    }
                                    
                                    const buttonContainer = document.createElement('div');
                                    buttonContainer.className = 'literature-buttons';
                                    
                                    if (item['Pubmed ID'] && item['Pubmed ID'].trim() !== '') {
                                        const pubmedLink = document.createElement('a');
                                        pubmedLink.href = `https://pubmed.ncbi.nlm.nih.gov/${item['Pubmed ID']}/`;
                                        pubmedLink.textContent = `PubMed ${item['Pubmed ID']}`;
                                        pubmedLink.target = '_blank';
                                        pubmedLink.rel = 'noopener noreferrer';
                                        pubmedLink.className = 'literature-link';
                                        pubmedLink.style.backgroundColor = '#2b1055';
                                        buttonContainer.appendChild(pubmedLink);
                                    }
                                    
                                    if (item.Reference) {
                                        const doiMatch = item.Reference.match(/doi:([^\\s.,;]+)/i);
                                        if (doiMatch) {
                                            const doi = doiMatch[1];
                                            const doiLink = document.createElement('a');
                                            doiLink.href = `https://doi.org/${doi}`;
                                            doiLink.textContent = `DOI ${doi}`;
                                            doiLink.target = '_blank';
                                            doiLink.rel = 'noopener noreferrer';
                                            doiLink.className = 'literature-link';
                                            doiLink.style.backgroundColor = '#4CAF50';
                                            buttonContainer.appendChild(doiLink);
                                        }
                                    }
                                    
                                    if (item.URL) {
                                        const urlLink = document.createElement('a');
                                        urlLink.href = item.URL;
                                        urlLink.textContent = 'View Article';
                                        urlLink.target = '_blank';
                                        urlLink.rel = 'noopener noreferrer';
                                        urlLink.className = 'literature-link';
                                        urlLink.style.backgroundColor = '#2196F3';
                                        buttonContainer.appendChild(urlLink);
                                    }
                                    
                                    if (buttonContainer.children.length > 0) {
                                        literatureDiv.appendChild(buttonContainer);
                                    }
                                    
                                    td.appendChild(literatureDiv);
                                } else if (typeof item === 'string') {
                                    const textElem = document.createElement('div');
                                    textElem.textContent = item;
                                    textElem.setAttribute('data-translate', '');
                                    textElem.style.marginBottom = '10px';
                                    td.appendChild(textElem);
                                }
                            });
                        } else if (value && typeof value === 'string') {
                            const textElem = document.createElement('div');
                            textElem.textContent = value;
                            textElem.setAttribute('data-translate', '');
                            td.appendChild(textElem);
                        } else {
                            const noDataElem = document.createElement('span');
                            noDataElem.textContent = 'No literature information available for this peptide';
                            noDataElem.style.color = '#666';
                            noDataElem.style.fontStyle = 'italic';
                            noDataElem.setAttribute('data-translate', '');
                            td.appendChild(noDataElem);
                        }
                    }
                    // 处理其他数组和链接 (UniProt Entry specifically)
                    else if (Array.isArray(value)) {
                        if (field === 'UniProt Entry') { // Specific handling for UniProt Entry array
                            value.forEach(item => {
                                const link = document.createElement('a');
                                link.href = String(item); // Ensure item is a string for URL
                                link.textContent = String(item);
                                td.appendChild(link);
                                td.appendChild(document.createElement('br'));
                            });
                        } else { // Fallback for other arrays not specifically handled
                            const textContainer = document.createElement('span');
                            // Avoid .join on arrays of objects, show a placeholder or count
                            if (value.every(val => typeof val === 'string' || typeof val === 'number')) {
                                textContainer.textContent = value.join(', ');
                            } else {
                                textContainer.textContent = `[Array of ${value.length} items]`; // Or handle more gracefully
                            }
                            textContainer.setAttribute('data-translate', '');
                            td.appendChild(textContainer);
                        }
                    }
                    // 特殊处理Pubmed ID（如果不是在Literature项内）
                    else if (field === 'Pubmed ID' && value) {
                        const link = document.createElement('a');
                        link.href = `http://www.ncbi.nlm.nih.gov/pubmed/?term=${value}`;
                        link.textContent = value;
                        td.appendChild(link);
                    } else {
                        const textElem = document.createElement('span');
                        if (typeof value === 'number') {
                            textElem.textContent = value.toString();
                        } else if (value === null || value === undefined || value === '') {
                            textElem.textContent = 'Not found';
                            textElem.style.color = '#999';
                            textElem.style.fontStyle = 'italic';
                        } else {
                            textElem.textContent = String(value); // Ensure value is stringified
                        }
                        
                        if (value !== null && value !== undefined && value !== '' && 
                            !field.includes('ID') && 
                            !field.includes('Mass') && 
                            !field.includes('PI') && 
                            !field.includes('Sequence') &&
                            !field.includes('Formula') &&
                            typeof value !== 'number') {
                            textElem.setAttribute('data-translate', '');
                        }
                        td.appendChild(textElem);
                    }

                    row.appendChild(td);
                    table.appendChild(row);
                });

                module.appendChild(table);
                fragment.appendChild(module);
            });
            
            // 批量更新DOM
            moduleContainer.innerHTML = '';
            moduleContainer.appendChild(fragment);
            
            // 添加简单的淡入效果
            moduleContainer.querySelectorAll('.module').forEach((module) => {
                module.classList.add('fade-in');
            });
            
            // 性能计时结束
            const endTime = performance.now();
            console.log(`页面渲染耗时: ${(endTime - startTime).toFixed(2)}ms`);
            
            // 延迟初始化翻译，避免阻塞渲染
            requestAnimationFrame(() => {
            initializeTranslation(getLanguagePreference());
            });
        }

        // 辅助函数：处理目标生物字符串
        function processOrganismString(str, containerList) {
            // 更精确地分割目标生物，处理括号内的逗号
            let organisms = [];
            let inParentheses = false;
            let currentOrg = '';
            
            for (let i = 0; i < str.length; i++) {
                const char = str[i];
                
                if (char === '(') {
                    inParentheses = true;
                    currentOrg += char;
                } else if (char === ')') {
                    inParentheses = false;
                    currentOrg += char;
                } else if ((char === ',' || char === ';') && !inParentheses) {
                    if (currentOrg.trim()) {
                        organisms.push(currentOrg.trim());
                    }
                    currentOrg = '';
                } else {
                    currentOrg += char;
                }
            }
            
            // 添加最后一个生物
            if (currentOrg.trim()) {
                organisms.push(currentOrg.trim());
            }
            
            // 处理每个分离的生物项
            organisms.forEach(org => {
                // 使用更通用的正则表达式来匹配各种敏感性标记格式
                const match = org.match(/(.*?)(\s*\([+\w\s.,]+\))?$/);
                
                if (match) {
                    const organismItem = document.createElement('li');
                    organismItem.className = 'organism-item';
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'organism-name';
                    nameSpan.textContent = match[1].trim();
                    nameSpan.setAttribute('data-translate', ''); // 标记为需要翻译
                    organismItem.appendChild(nameSpan);
                    
                    // 如果有敏感性/信息标记，添加它
                    if (match[2]) {
                        const susceptSpan = document.createElement('span');
                        susceptSpan.className = 'organism-susceptibility';
                        
                        // 判断敏感性标记类型并设置颜色
                        const susceptText = match[2].trim();
                        susceptSpan.textContent = susceptText;
                        
                        // 根据加号数量确定颜色
                        const plusCount = (susceptText.match(/\\+/g) || []).length;
                        if (plusCount >= 3) {
                            susceptSpan.style.color = '#4CAF50'; // 高敏感性绿色
                        } else if (plusCount >= 2) {
                            susceptSpan.style.color = '#2196F3'; // 中等敏感性蓝色
                        } else if (plusCount >= 1) {
                            susceptSpan.style.color = '#FFC107'; // 低敏感性黄色
                        }
                        
                        organismItem.appendChild(susceptSpan);
                    }
                    
                    containerList.appendChild(organismItem);
                } else {
                    // 如果无法解析格式，直接添加整个字符串
                    const organismItem = document.createElement('li');
                    organismItem.className = 'organism-item';
                    organismItem.textContent = org;
                    organismItem.setAttribute('data-translate', ''); // 标记为需要翻译
                    containerList.appendChild(organismItem);
                }
            });
        }



        // 顶部导航栏功能由 header-nav.js 组件处理

        // 保存语言偏好
        function saveLanguagePreference(lang) {
            localStorage.setItem('preferredLanguage', lang);
        }

        // 获取保存的语言偏好
        function getLanguagePreference() {
            return localStorage.getItem('preferredLanguage') || 'en';
        }

        // 获取语言显示名称
        function getLanguageDisplayName(langCode) {
            const langNames = {
                'en': 'English',
                'zh-Hans': '中文 (简体)',
                'zh-Hant': '繁體中文',
                'ja': '日本語',
                'ko': '한국어',
                'fr': 'Français',
                'de': 'Deutsch',
                'es': 'Español',
                'ru': 'Русский'
            };
            return langNames[langCode] || langCode;
        }

        // 初始化语言功能
        document.addEventListener('DOMContentLoaded', function() {
            // 导航栏活动状态由 header-nav.js 组件自动处理

            // 快速笔记按钮事件处理
            const notesBtn = document.getElementById('quick-notes-btn');
            if (notesBtn) {
                notesBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (window.quickNotes) {
                        window.quickNotes.toggle();
                    }
                });
            }
            
            const savedLang = getLanguagePreference();
            document.documentElement.lang = savedLang;
            
            // 更新当前语言显示
            updateCurrentLanguageDisplay();
            
            // 初始化多语言选择
            const langOptions = document.querySelectorAll('.language-options a');
            langOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    const newLang = this.getAttribute('data-lang');
                    if (newLang === document.documentElement.lang) return;
                    
                    // 保存语言设置并刷新页面
                    saveLanguagePreference(newLang);
                    
                    // 获取当前URL并添加时间戳参数以确保刷新
                    const currentUrl = new URL(window.location.href);
                    currentUrl.searchParams.set('ts', Date.now());
                    window.location.href = currentUrl.toString();
                });
            });
        });
        
        // 更新当前语言显示
        function updateCurrentLanguageDisplay() {
            const currentLang = document.getElementById('currentLang');
            const currentLangText = document.getElementById('currentLangText');
            
            currentLangText.textContent = getLanguageDisplayName(document.documentElement.lang);
            
            currentLang.classList.add('no-translate');
            currentLangText.classList.add('no-translate');
        }
        
        // 初始化翻译函数
        function initializeTranslation(lang) {
            // 全局特殊术语配置
            window.specialTerms = {
                'en': { 'SPADE': 'SPADE' },
                'zh-Hans': {
                    'SPADE': 'SPADE',
                    'Peptide Details': '肽详情',
                    'General Information': '基本信息',
                    'Activity Information': '活性信息',
                    'Structural Information': '结构信息',
                    'Physicochemical Properties': '物理化学特性',
                    'Comments Information': '备注信息',
                    'Literature Information': '参考文献',
                    'Home': '首页',
                    'Search': '搜索',
                    'Tools': '工具',
                    'AMP Visualization': '抗菌肽可视化',
                    'Statistics': '统计',
                    'Source': '来源',
                    'Family': '家族',
                    'Sequence Length': '序列长度',
                    'Biological Activity': '生物活性',
                    'Gene': '基因',
                    'Sequence': '序列',
                    'UniProt Entry': 'UniProt条目',
                    'Protein Existence': '蛋白质存在性',
                    'Target Organism': '目标生物',
                    'Hemolytic Activity': '溶血活性',
                    'Cytotoxicity': '细胞毒性',
                    'Binding Target': '结合靶点',
                    'Linear/Cyclic': '线性/环状',
                    'DRAMP ID': 'DRAMP ID',
                    'Select a Section': '选择一个部分',
                    'Not found': '未找到',
                    'Belongs to 2025-XJTLU-Software': '属于2025-XJTLU-Software团队',
                    'Formula': '分子式',
                    'Absent Amino Acids': '缺失氨基酸',
                    'Common Amino Acids': '常见氨基酸',
                    'Mass': '质量',
                    'PI': '等电点',
                    'Basic Residues': '碱性残基',
                    'Acidic Residues': '酸性残基',
                    'Hydrophobic Residues': '疏水残基',
                    'Net Charge': '净电荷',
                    'Boman Index': 'Boman指数',
                    'Hydrophobicity': '疏水性',
                    'Aliphatic Index': '脂肪族指数',
                    'Half Life': '半衰期',
                    'Extinction Coefficient Cystines': '消光系数(含半胱氨酸)',
                    'Absorbance 280nm': '280nm吸光度',
                    'Polar Residues': '极性残基',
                    'Function': '功能',
                    'PTM': '翻译后修饰',
                    'Title': '标题',
                    'Pubmed ID': 'PubMed ID',
                    'Reference': '引用',
                    'Author': '作者',
                    'N-terminal Modification': 'N端修饰',
                    'C-terminal Modification': 'C端修饰',
                    'Nonterminal Modifications and Unusual Amino Acids': '非末端修饰和非常规氨基酸',
                    'Stereochemistry': '立体化学',
                    'Structure': '结构',
                    'Structure Description': '结构描述',
                    'Helical Wheel Diagram': '螺旋轮图',
                    'PDB ID': 'PDB编号',
                    'Predicted Structure': '预测结构',
                    'Peptide Name': '肽名称',
                    'Efficacy': '效力',
                    'Toxicity': '毒性',
                    'Stability': '稳定性',
                    'Synthesis': '合成',
                    'Original Score By Category': '各类别原始分数',
                    'Total Score': '总分',
                    'Note:': '注意：',
                    'Data loading failed': '数据加载失败',
                    'PubMed ID': 'PubMed ID',
                    'DOI': 'DOI',
                    'View Article': '查看文章',
                    'View Structure': '查看结构',
                    'No structure available': '无可用结构',
                    'Structure': '结构',
                    'Predicted Structure': '预测结构',
                    'PDB ID': 'PDB编号'
                },
                'zh-Hant': {
                    'SPADE': 'SPADE',
                    'Peptide Details': '肽詳情',
                    'General Information': '基本信息',
                    'Activity Information': '活性信息',
                    'Structural Information': '結構信息',
                    'Physicochemical Properties': '物理化學特性',
                    'Comments Information': '備註信息',
                    'Literature Information': '參考文獻',
                    'Home': '首頁',
                    'Search': '搜索',
                    'Tools': '工具',
                    'AMP Visualization': '抗菌肽可視化',
                    'Statistics': '統計',
                    'Source': '來源',
                    'Family': '家族',
                    'Sequence Length': '序列長度',
                    'Biological Activity': '生物活性',
                    'Gene': '基因',
                    'Sequence': '序列',
                    'UniProt Entry': 'UniProt條目',
                    'Protein Existence': '蛋白質存在性',
                    'Target Organism': '目標生物',
                    'Hemolytic Activity': '溶血活性',
                    'Cytotoxicity': '細胞毒性',
                    'Binding Target': '結合靶點',
                    'Linear/Cyclic': '線性/環狀',
                    'DRAMP ID': 'DRAMP ID',
                    'Select a Section': '選擇一個部分',
                    'Not found': '未找到',
                    'Belongs to 2025-XJTLU-Software': '屬於2025-XJTLU-Software團隊',
                    'Formula': '分子式',
                    'Absent Amino Acids': '缺失氨基酸',
                    'Common Amino Acids': '常見氨基酸',
                    'Mass': '質量',
                    'PI': '等電點',
                    'Basic Residues': '鹼性殘基',
                    'Acidic Residues': '酸性殘基',
                    'Hydrophobic Residues': '疏水殘基',
                    'Net Charge': '淨電荷',
                    'Boman Index': 'Boman指數',
                    'Hydrophobicity': '疏水性',
                    'Aliphatic Index': '脂肪族指數',
                    'Half Life': '半衰期',
                    'Extinction Coefficient Cystines': '消光係數(含半胱氨酸)',
                    'Absorbance 280nm': '280nm吸光度',
                    'Polar Residues': '極性殘基',
                    'Function': '功能',
                    'PTM': '翻譯後修飾',
                    'Title': '標題',
                    'Pubmed ID': 'PubMed ID',
                    'Reference': '引用',
                    'Author': '作者',
                    'N-terminal Modification': 'N端修飾',
                    'C-terminal Modification': 'C端修飾',
                    'Nonterminal Modifications and Unusual Amino Acids': '非末端修飾和非常規氨基酸',
                    'Stereochemistry': '立體化學',
                    'Structure': '結構',
                    'Structure Description': '結構描述',
                    'Helical Wheel Diagram': '螺旋輪圖',
                    'PDB ID': 'PDB编号',
                    'Predicted Structure': '預測結構',
                    'Peptide Name': '肽名稱',
                    'Efficacy': '效力',
                    'Toxicity': '毒性',
                    'Stability': '穩定性',
                    'Synthesis': '合成',
                    'Original Score By Category': '各類別原始分數',
                    'Total Score': '總分',
                    'Note:': '注意：',
                    'Data loading failed': '數據加載失敗',
                    'PubMed ID': 'PubMed ID',
                    'DOI': 'DOI',
                    'View Article': '查看文章',
                    'View Structure': '查看结构',
                    'No structure available': '无可用结构',
                    'Structure': '结构',
                    'Predicted Structure': '预测结构',
                    'PDB ID': 'PDB编号'
                },
                'ja': {
                    'SPADE': 'SPADE',
                    'Peptide Details': 'ペプチド詳細',
                    'General Information': '基本情報',
                    'Activity Information': '活性情報',
                    'Structural Information': '構造情報',
                    'Physicochemical Properties': '物理化学的特性',
                    'Comments Information': '備考情報',
                    'Literature Information': '参考文献',
                    'Home': 'ホーム',
                    'Search': '検索',
                    'Tools': 'ツール',
                    'AMP Visualization': '抗菌ペプチド可視化',
                    'Statistics': '統計',
                    'Source': '出典',
                    'Family': 'ファミリー',
                    'Sequence Length': '配列長',
                    'Biological Activity': '生物活性',
                    'Gene': '遺伝子',
                    'Sequence': '配列',
                    'UniProt Entry': 'UniProtエントリー',
                    'Select a Section': 'セクションを選択',
                    'Not found': '見つかりません',
                    'Belongs to 2025-XJTLU-Software': '2025-XJTLU-Softwareチームに属しています',
                    'Target Organism': '標的生物',
                    'Peptide Name': 'ペプチド名',
                    'Efficacy': '効力',
                    'Toxicity': '毒性',
                    'Stability': '安定性',
                    'Synthesis': '合成',
                    'Original Score By Category': 'カテゴリー別元スコア',
                    'Total Score': '合計スコア',
                    'Note:': '注意：',
                    'Data loading failed': 'データの読み込みに失敗しました',
                    'PubMed ID': 'PubMed ID',
                    'DOI': 'DOI',
                    'View Article': '查看文章',
                    'Author': '作者',
                    'Title': '标题',
                    'Reference': '引用',
                    'View Structure': '查看结构',
                    'No structure available': '无可用结构',
                    'Structure': '结构',
                    'Predicted Structure': '预测结构',
                    'PDB ID': 'PDB编号'
                },
                'ko': { 'SPADE': 'SPADE' },
                'fr': { 'SPADE': 'SPADE' },
                'de': { 'SPADE': 'SPADE' },
                'es': { 'SPADE': 'SPADE' },
                'ru': { 'SPADE': 'SPADE' }
            };
            
            const tranzy = new Tranzy.Translator({
                toLang: lang,
                fromLang: 'en',
                ignore: ['.no-translate', '.sequence'],
                manualDict: window.specialTerms
            });
            
            tranzy.translatePage();
            tranzy.startObserver();
            
            // 将翻译实例保存到全局变量，以便之后销毁
            window.tranzyInstance = tranzy;
        }

        // 图片懒加载优化
        class LazyLoader {
            constructor() {
                this.observer = new IntersectionObserver(this.handleIntersection.bind(this), {
                    rootMargin: '50px'
                });
            }

            handleIntersection(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        if (img.dataset.src) {
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                            this.observer.unobserve(img);
                        }
                    }
                });
            }

            observe(element) {
                this.observer.observe(element);
            }
        }

        const lazyLoader = new LazyLoader();

        // 性能优化：防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 性能优化：节流函数
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        // 优化的响应式布局增强脚本
        document.addEventListener('DOMContentLoaded', function() {
            // 移动端导航功能由 header-nav.js 组件处理
            
            // 预加载关键资源
            preloadCriticalResources();
        });

        // 预加载关键资源
        function preloadCriticalResources() {
            // 预加载CSS中使用的关键字体
            const fontPreload = document.createElement('link');
            fontPreload.rel = 'preload';
            fontPreload.href = 'https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900&display=swap';
            fontPreload.as = 'style';
            fontPreload.onload = function() {
                this.onload = null;
                this.rel = 'stylesheet';
            };
            document.head.appendChild(fontPreload);

            // 预连接到可能的外部域
            const preconnectLinks = [
                'https://unpkg.com',
                'https://cdnjs.cloudflare.com',
                'https://www.rcsb.org',
                'https://pubmed.ncbi.nlm.nih.gov'
            ];

            preconnectLinks.forEach(href => {
                const link = document.createElement('link');
                link.rel = 'preconnect';
                link.href = href;
                document.head.appendChild(link);
            });
        }
    </script>
</body>
</html>
